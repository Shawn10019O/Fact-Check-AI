<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ファクトチェック Web アプリ</title>
  <style>
    :root {
      --accent: #6366f1;
      --bg: #f7f7fa;
      --card: #ffffff;
      --radius: 12px;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --font: "Segoe UI", Roboto, sans-serif;
    }
    * {box-sizing: border-box;}
    body {
      margin: 0; padding: 0; font-family: var(--font); background: var(--bg); color:#333;
    }
    header {
      background: var(--accent); color:#fff; padding:1.5rem 2rem; text-align:center;
      box-shadow: var(--shadow);
    }
    h1 { margin: 0; font-size:1.5rem; font-weight:600; }

    main { max-width:760px; margin:2rem auto; padding:0 1rem; }

    .uploader {
      background: var(--card); border:2px dashed var(--accent); border-radius:var(--radius);
      padding:2.5rem 1rem; text-align:center; cursor:pointer; transition:background .2s;
    }
    .uploader:hover { background:#eef; }
    .uploader input { display:none; }

    button {
      background: var(--accent); color:#fff; border:none; border-radius:var(--radius);
      padding:.75rem 1.5rem; font-size:1rem; cursor:pointer; margin-top:1rem;
      box-shadow: var(--shadow); transition:opacity .2s;
    }
    button:disabled { opacity:.5; cursor:not-allowed; }

    .card {
      background: var(--card); border-radius:var(--radius); box-shadow: var(--shadow);
      padding:1rem 1.25rem; margin-top:1rem;
    }
    .claim { font-weight:600; margin-bottom:.25rem; }
    .verdict { margin-bottom:.5rem; }
    .supported { color:#16a34a; }
    .refuted   { color:#dc2626; }
    .unknown   { color:#f59e0b; }
    .sources a { font-size:.9rem; display:block; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .spinner {width:40px;height:40px;border:4px solid #d1d5db;border-top:4px solid var(--accent);border-radius:50%;animation:spin 1s linear infinite;margin:2rem auto;}
    @keyframes spin {to {transform:rotate(360deg);}}
  </style>
</head>
<body>
  <header>
    <h1>ファクトチェック AI</h1>
  </header>

  <main>
    <label class="uploader" id="uploader">
      <input type="file" id="fileInput" accept=".pptx,.pdf" />
      <p>ここをクリックして PPTX / PDF を選択<br><small>またはドラッグ＆ドロップ</small></p>
    </label>
    <div style="text-align:center;">
      <button id="runBtn" disabled>ファクトチェック開始</button>
    </div>

    <div id="results"></div>
  </main>

  <script>
    const API_URL = "http://localhost:8000/check"; // バックエンド側で変更したら揃える

    const fileInput = document.getElementById("fileInput");
    const runBtn    = document.getElementById("runBtn");
    const results   = document.getElementById("results");
    const uploader  = document.getElementById("uploader");

    // drag&drop support
    ;["dragenter","dragover","dragleave","drop"].forEach(evt=>{
      uploader.addEventListener(evt,e=>e.preventDefault());
    });
    uploader.addEventListener("drop",e=>{
      fileInput.files = e.dataTransfer.files;
      onFileChosen();
    });

    fileInput.addEventListener("change", onFileChosen);

    function onFileChosen(){
      if(fileInput.files.length){ runBtn.disabled=false; uploader.querySelector("p").textContent = fileInput.files[0].name; }
    }

    runBtn.addEventListener("click", async ()=>{
      if(!fileInput.files.length) return;
      runBtn.disabled = true; results.innerHTML = "<div class='spinner'></div>";
      const formData = new FormData();
      formData.append("file", fileInput.files[0]);
      try{
        const resp = await fetch(API_URL, {method:"POST", body:formData});
        if(!resp.ok) throw new Error("API error: "+resp.status);
        const data = await resp.json();
        displayResults(data);
      }catch(err){
        console.error(err);
        results.innerHTML = `<p class='card' style='color:#dc2626;'>エラー: ${err.message}</p>`;
      }finally{ runBtn.disabled=false; }
    });

    function displayResults(data){
      // data = [{claim, verdict, sources:[{title, link, reliability}]}]
      if(!Array.isArray(data)||!data.length){
        results.innerHTML = "<p class='card'>結果がありませんでした。</p>";return;
      }
      results.innerHTML = "";
      data.forEach(r=>{
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <div class='claim'>${r.claim}</div>
          <div class='verdict ${cls(r.verdict)}'>${r.verdict}</div>
          <div class='sources'>${r.sources.map(s=>`<a href='${s.link}' target='_blank'>[${s.reliability}] ${s.title}</a>`).join("")}</div>
        `;
        results.appendChild(div);
      });
    }
    function cls(v){
      if(v.startsWith("SUPPORTED")) return "supported";
      if(v.startsWith("REFUTED"))   return "refuted";
      return "unknown";
    }
  </script>
</body>
</html>
